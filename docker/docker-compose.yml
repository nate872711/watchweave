services:
  flexboxd:
    container_name: flexboxd
    image: nate8727/flexboxd:latest
    build:
      context: ..
      dockerfile: docker/Dockerfile
    restart: unless-stopped
    environment:
      # Core configuration
      - TZ=UTC
      - PLEX_BASE_URL=${PLEX_BASE_URL}
      - PLEX_TOKEN=${PLEX_TOKEN}

      # Letterboxd CSV sync
      - CSV_PATH=${CSV_PATH:-/config/letterboxd_diary.csv}
      - DEDUPE_DAYS=${DEDUPE_DAYS:-2}
      - MIN_PERCENT=${MIN_PERCENT:-85}

      # Trakt integration
      - TRAKT_CLIENT_ID=${TRAKT_CLIENT_ID}
      - TRAKT_CLIENT_SECRET=${TRAKT_CLIENT_SECRET}
      - TRAKT_ACCESS_TOKEN=${TRAKT_ACCESS_TOKEN}
      - TRAKT_REDIRECT_URI=${TRAKT_REDIRECT_URI}
      - ENABLE_TRAKT_SYNC=${ENABLE_TRAKT_SYNC:-true}

      # IMDb integration
      - IMDB_RATINGS_CSV=${IMDB_RATINGS_CSV:-/config/imdb/ratings.csv}
      - IMDB_WATCHLIST_CSV=${IMDB_WATCHLIST_CSV:-/config/imdb/watchlist.csv}
      - ENABLE_WATCHLIST_SYNC=${ENABLE_WATCHLIST_SYNC:-true}
      - ENABLE_COLLECTION_SYNC=${ENABLE_COLLECTION_SYNC:-true}

      # Optional webhook notifications
      - WEBHOOK_URL=${WEBHOOK_URL:-}

    volumes:
      - ./data:/config
    ports:
      - "8089:8089"
    command: >
      bash -c "
        echo 'Starting Flexboxd sync service...';
        python -m src.main
      "
